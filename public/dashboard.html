<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
    <link rel="stylesheet" type="text/css" href="assets/css/dash.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
     integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
   
    <title>Dashboard</title>
</head> 
<body>
    <!--nav bar-->
    <nav class="navbar navbar-light">
        <a class="navbar-brand">Activity Deck</a>
       <form class="form-inline">
            <a type="submit" class="dash btn btn-outline-success my-2 my-sm-0" href="index.html">Back</a>
          </form>
        </nav>  

      <!--copying from the blog example-->
        <div class="container">
          <div class="row mt-4">
            <div class="col-md-4">
              <div class="form-group">
                <select class="custom-select" id="category">
                  <option selected value="">All Categories</option>
                  <option value="Jiu Jitsu">Jiu Jitsu</option>
                  <option value="Dance">Dance</option>
                  <option value="Gym">Gym</option>
                  <option value="Swimming">Swimming</option>
                  <option value="Yoga">Yoga</option>
                </select>
              </div>
            </div>
            <div class="col-md-2">
              <a class="btn btn-light" href="/cms">Add Activity</a>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 blog-container">
            </div>
          </div>
        </div>
        <!-- Custom Script -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.0/moment.min.js" type="text/javascript"></script>
        <script src="js/blog.js" type="text/javascript"></script>
      


<div class="display-act"></div>

      <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>
</html>

<script src="https://code.jquery.com/jquery.js"></script>
<script>
$(document).ready(function() {
  // display holds all of our posts
  var display = $(".display-act");
  var activityCategorySelect = $("#category");
  // Click events for the edit and delete buttons
  $(document).on("click", "button.delete", handleActivityDelete);
  $(document).on("click", "button.edit", handleActivityEdit);
  activityCategorySelect.on("change", handleCategoryChange);
  var activities;

  // This function grabs posts from the database and updates the view
  function getActivities(category) {
    var categoryString = category || "";
    if (categoryString) {
      categoryString = "/category/" + categoryString;
    }
    $.get("/api/activities" + categoryString, function(data) {
      console.log("Activities", data);
      activities = data;
      if (!activities || !activities.length) {
        displayEmpty();
      }
      else {
        initializeRows();
      }
    });
  }

  // This function does an API call to delete posts
  function deleteActivity(id) {
    $.ajax({
      method: "DELETE",
      url: "/api/activities/" + id
    })
      .then(function() {
        getActivities(activityCategorySelect.val());
      });
  }

  // Getting the initial list of posts
  getActivities();
  // InitializeRows handles appending all of our constructed post HTML inside
  // blogContainer
  function initializeRows() {
    display.empty();
    var activitiesToAdd = [];
    for (var i = 0; i < activities.length; i++) {
      activitiesToAdd.push(createNewRow(activities[i]));
    }
    display.append(activitiesToAdd);
  }

  // This function constructs a post's HTML
  function createNewRow() {
    var newActivityCard = $("<div>");
      newActivityCard.addClass("card");
    var newActivityCardHeading = $("<div>");
    newActivityCardHeading.addClass("card-header");
    var deleteBtn = $("<button>");
    deleteBtn.text("x");
    deleteBtn.addClass("delete btn btn-danger");
    var editBtn = $("<button>");
    editBtn.text("EDIT");
    editBtn.addClass("edit btn btn-default");
    var newActivityAct = $("<h2>");
    var newActivityCategory = $("<h5>");
      newActivityCategory.text(activity.category);
      newActivityCategory.css({
      float: "right",
      "font-weight": "700",
      "margin-top":
      "-15px"
    });
    var newActivityCardhowto = $("<div>");
    newActivityCardhowto.addClass("card-body");
    var newActivityhowto = $("<p>");
    newActivityAct.text(activity.act + " ");
    newActivityhowto.text(activity.howto);
    
    
    
    newActivityCardHeading.append(deleteBtn);
    newActivityCardHeading.append(editBtn);
    newActivityCardHeading.append(newActivityAct);
    newActivityCardHeading.append(newActivityCategory);
    newActivityCardBody.append(newActivityhowto);
    newActivityCard.append(newActivityCardHeading);
    newActivityCard.append(newActivityCardhowto);
    newActivityCard.data("activity", activity);
    return newActivityCard;
  }

  // This function figures out which post we want to delete and then calls
  // deletePost
  function handleActivityDelete() {
    var currentActivity = $(this)
      .parent()
      .parent()
      .data("Activity");
    deleteActivity(currentActivity.id);
  }

  // This function figures out which post we want to edit and takes it to the
  // Appropriate url
  function handleActivityEdit() {
    var currentActivity = $(this)
      .parent()
      .parent()
      .data("activity");
    window.location.href = "/cms?activity_id=" + currentActivity.id;
  }

  // This function displays a message when there are no posts
  function displayEmpty() {
    display.empty();
    var messageH2 = $("<h2>");
    messageH2.css({ "text-align": "center", "margin-top": "50px" });
    messageH2.html("No activity yet for this category, navigate <a href='/cms'>here</a> in order to create a new post.");
    display.append(messageH2);
  }

  // This function handles reloading new posts when the category changes
  function handleCategoryChange() {
    var newActivityCategory = $(this).val();
    getActivities(newActivityCategory);
  }

});



</script>